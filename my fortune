#!/bin/bash

# Define the log file path in the user's home directory
LOG_FILE="$HOME/.unique_fortune_log"

# Function to ensure the log file exists and has some initial data
initialize_log() {
    if [[ ! -f "$LOG_FILE" ]]; then
        echo "The journey of a thousand miles begins with a single step." > "$LOG_FILE"
        echo "The best way to predict the future is to create it." >> "$LOG_FILE"
        echo "Innovation distinguishes between a leader and a follower." >> "$LOG_FILE"
        echo "Stay hungry, stay foolish." >> "$LOG_FILE"
        echo "It does not matter how slowly you go as long as you do not stop." >> "$LOG_FILE"
        echo "Success is a journey, not a destination." >> "$LOG_FILE"
    fi
}

# Function to generate and display a unique fortune
generate_fortune() {
    # Initialize the log file if needed
    initialize_log

    # Count lines in the log file
    local line_count=$(wc -l < "$LOG_FILE")

    # Get random line numbers
    local rand_line1=$(( ( RANDOM % line_count ) + 1 ))
    local rand_line2=$(( ( RANDOM % line_count ) + 1 ))

    # Get the lines from the log file
    local part1=$(sed -n "${rand_line1}p" "$LOG_FILE")
    local part2=$(sed -n "${rand_line2}p" "$LOG_FILE")

    # Combine them with a unique, time-based separator
    local separator=" # $(date +'%H:%M:%S') # "
    local unique_fortune="$part1$separator$part2"

    # Display the fortune in a Linux-style box
    echo "====================================================="
    echo " Your Linux Fortune (unique) "
    echo "====================================================="
    echo ""
    # Use 'fmt' to wrap the text nicely within a certain width
    echo "$unique_fortune" | fmt -w 50
    echo ""
    echo "====================================================="

    # Add the new fortune back to the log file for future inspiration
    echo "$unique_fortune" >> "$LOG_FILE"
}

# Run the function
generate_fortune
